<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="icon" type="image/png" href="/images/logo.png" />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f4f9f9;
        margin: 0;
        padding: 0;
      }

      .admin-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 30px;
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        animation: fadeIn 0.4s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h2 {
        color: #008080;
        border-left: 5px solid #008080;
        padding-left: 10px;
        margin-bottom: 25px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        text-align: left;
      }

      th,
      td {
        padding: 12px 15px;
        border-bottom: 1px solid #ddd;
      }

      th {
        background-color: #008080;
        color: white;
      }

      tr:hover {
        background-color: #f1f1f1;
      }

      .status {
        font-weight: bold;
        text-transform: capitalize;
        border-radius: 6px;
        padding: 6px 12px;
        display: inline-block;
        text-align: center;
        transition: 0.3s;
      }

      .status.accepted {
        background-color: #d4edda;
        color: #155724;
      }
      .status.declined {
        background-color: #f8d7da;
        color: #721c24;
      }
      .status.pending {
        background-color: #e2e3e5;
        color: #383d41;
      }

      .actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .actions button {
        background-color: #008080;
        color: white;
        border: none;
        padding: 8px 14px;
        border-radius: 6px;
        cursor: pointer;
        transition: 0.3s;
        font-family: "Poppins", sans-serif;
        font-size: 14px;
      }

      .actions button:hover {
        background-color: #006666;
      }
      .decline {
        background-color: #cc0000;
      }
      .decline:hover {
        background-color: #a30000;
      }

      .no-data {
        text-align: center;
        color: #777;
        padding: 20px 0;
      }

      .flash-message {
        text-align: center;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 15px;
        font-weight: 600;
        animation: fadeIn 0.5s ease;
      }
      .flash-success {
        background-color: #d4edda;
        color: #155724;
      }
      .flash-error {
        background-color: #f8d7da;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <!-- ✅ Admin Navbar -->
    <%- include('admin/navbaradmin') %>

    <div class="admin-container">
      <h2>Booking Management</h2>

      <!-- ✅ Flash message -->
      <% if (message) { %>
      <div
        class="flash-message <%= message.type === 'success' ? 'flash-success' : 'flash-error' %>"
      >
        <%= message.text %>
      </div>
      <% } %> <% if (bookings && bookings.length > 0) { %>
      <table>
        <thead>
          <tr>
            <th>Guest Name</th>
            <th>Room</th>
            <th>Check-In</th>
            <th>Check-Out</th>
            <th>Guests</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% bookings.forEach(b => { %>
          <tr id="row-<%= b._id %>">
            <td><%= b.name || "N/A" %></td>
            <td><%= b.room || "N/A" %></td>
            <td>
              <%= b.checkin ? new Date(b.checkin).toLocaleDateString() : "—" %>
            </td>
            <td>
              <%= b.checkout ? new Date(b.checkout).toLocaleDateString() : "—"
              %>
            </td>
            <td><%= b.guests || 1 %></td>
            <td>
              <span class="status <%= b.status || 'pending' %>">
                <%= b.status ? b.status.charAt(0).toUpperCase() +
                b.status.slice(1) : 'Pending' %>
              </span>
            </td>
            <td>
              <div class="actions">
                <% if (b.status === 'pending') { %>
                <form
                  method="POST"
                  action="/admin/accept/<%= b._id %>"
                  onsubmit="return confirmAction('accept', '<%= b._id %>')"
                >
                  <button type="submit">Accept</button>
                </form>
                <form
                  method="POST"
                  action="/admin/decline/<%= b._id %>"
                  onsubmit="return confirmAction('decline', '<%= b._id %>')"
                >
                  <button type="submit" class="decline">Decline</button>
                </form>
                <% } else { %>
                <em>No actions available</em>
                <% } %>
              </div>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
      <% } else { %>
      <p class="no-data">No bookings available.</p>
      <% } %>
    </div>

    <script>
      // ✅ Confirm action before submitting form
      function confirmAction(action, id) {
        const confirmed = confirm(
          `Are you sure you want to ${action} this booking?`
        );
        return confirmed; // true = continue, false = cancel
      }
    </script>
  </body>
</html>
